<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Event Check-In</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 400px; margin: auto; }
    .attendee { border: 1px solid #ccc; padding: 20px; margin-top: 20px; }
    label { font-weight: bold; }
  </style>
</head>
<body>
  <h2>Check-In Scanner</h2>
  <div id="result">Loading...</div>

  <script>
    // Read email parameter from URL
    function getEmailFromUrl() {
      const params = new URLSearchParams(window.location.search);
      return params.get('email');
    }

    const email = getEmailFromUrl();
    const resultDiv = document.getElementById('result');

    if (!email) {
      resultDiv.innerHTML = "<p style='color:red;'>No email provided in the URL.</p>";
    } else {

      // ✅ Use your Cloudflare Worker — NOT googleusercontent
      const baseUrl = "https://green-poetry-c7a4.seifeddine-znati.workers.dev/?email=";

      // Build final URL
      const scriptUrl = baseUrl + encodeURIComponent(email);

      // Fetch attendee info
      fetch(scriptUrl, { cache: "no-store" })
        .then(response => response.json())
        .then(data => {
          if (!data || Object.keys(data).length === 0 || data.error) {
            resultDiv.innerHTML = "<p style='color:red;'>Attendee not found!</p>";
          } else {
            // Display info
            resultDiv.innerHTML = `
              <div class="attendee">
                <p><label>Nombre & Apellido:</label> ${data.nombre} ${data.apellido}</p>
                <p><label>Cargo:</label> ${data.cargo}</p>
                <p><label>Correo Electronico:</label> ${data.correo}</p>
                <p><label>Empresa:</label> ${data.empresa}</p>
              </div>`;
          }
        })
        .catch(err => {
          resultDiv.innerHTML = "<p style='color:red;'>Error fetching data.</p>";
          console.error(err);
        });
    }
  </script>
</body>
</html>
